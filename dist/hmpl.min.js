!function(e,t){"object"==typeof module&&module.exports?module.exports=t():"function"==typeof define&&define.amd?define([],t):e.hmpl=e.hmpl||t()}("undefined"!=typeof self?self:this,(function(){return function(){"use strict";const e=e=>"object"==typeof e&&!Array.isArray(e)&&null!==e,t=e=>{throw new Error(e)},o=e=>{console.warn(e)},n="method",r="initId",s="after",i="isRepeatable",l="indicators",d=/([{}])/,c=[100,101,102,103,300,301,302,303,304,305,306,307,308,400,401,402,403,404,405,406,407,408,409,410,411,412,413,414,415,416,417,418,421,422,423,424,425,426,428,429,431,451,500,501,502,503,504,505,506,507,508,510,511],a=e=>(new DOMParser).parseFromString(`<template>${e}</template>`,"text/html").childNodes[0].childNodes[0].firstChild,p=(n,r,s,i,l,d,c,p={},f,u,h)=>{const{mode:g,cache:y,redirect:m,get:v,referrerPolicy:b,signal:N,credentials:T,timeout:w,referrer:E,headers:I,body:j,window:$,integrity:C}=p,O={method:i.toUpperCase()};void 0!==T&&(O.credentials=T),void 0!==j&&(O.body=j),void 0!==g&&(O.mode=g),void 0!==y&&(O.cache=y),void 0!==m&&(O.redirect=m),void 0!==b&&(O.referrerPolicy=b),void 0!==C&&(O.integrity=C),void 0!==E&&(O.referrer=E);const x=void 0!==N;if(x&&(O.signal=N),void 0!==$&&(O.window=$),void 0!==p.keepalive&&o("keepalive property is not yet supported"),I)if(e(I)){const e=new Headers;for(const o in I){const[n,r]=o;if("string"==typeof r)try{e.set(n,r)}catch(e){throw e}else t("Header has no string value")}O.headers=e}else t('The "header" property does not have a value object');w&&(x?o("The signal property overwrote the AbortSignal from timeout"):O.signal=AbortSignal.timeout(w));const k=(e,o=!0)=>{if(d)f.response=e.cloneNode(!0),v?.("response",e);else{let i=[];const l=(o?e.cloneNode(!0):e).content.childNodes;if(s.nodes){const e=s.parentNode;e||t("parentNode is null");const o=[],n=s.nodes.length;for(let t=0;t<n;t++){const r=s.nodes[t];if(t===n-1)for(let t=0;t<l.length;t++){const n=l[t],s=e.insertBefore(n,r);o.push(s)}e.removeChild(r)}i=o.slice(),s.nodes=o}else{const e=n.parentNode,t=[];for(let o=0;o<l.length;o++){const r=l[o],s=e.insertBefore(r,n);t.push(s)}e.removeChild(n),i=t.slice(),s.nodes=t,s.parentNode=e}c&&(u.response=i,v?.("response",i,u)),v?.("response",r)}};let A=!1,S=!1;const q=()=>{if(d)f.response=void 0,v?.("response",void 0);else if(s.nodes){const e=s.parentNode;e||t("parentNode is null");const o=s.nodes.length;for(let t=0;t<o;t++){const n=s.nodes[t];t===o-1&&e.insertBefore(s.comment,n),e.removeChild(n)}s.nodes=null,s.parentNode=null,c&&(u.response=void 0,v?.("response",void 0,u)),v?.("response",r)}},P=e=>{c?u.status!==e&&(u.status=e,v?.("status",e,u)):f.status!==e&&(f.status=e,v?.("status",e)),(e=>{if(h)if("pending"===e){const e=h.pending;void 0!==e&&k(e)}else if("rejected"===e){const e=h.rejected;if(void 0!==e)k(e);else{const e=h.error;void 0!==e?k(e):q()}}else{const t=h[`${e}`];if(e>399)if(A=!0,void 0!==t)k(t);else{const e=h.error;void 0!==e?k(e):q()}else(e<199||e>299)&&(S=!0,void 0!==t?k(t):q())}})(e)};P("pending"),fetch(l,O).then((e=>(P(e.status),e.ok||t(`Request error with code ${e.status}`),e.text()))).then((e=>{if(!S){const o=(e=>{"string"!=typeof e&&t("Bad response");const o=a(e),n=o.content,r=n.querySelectorAll("script");for(let e=0;e<r.length;e++){const t=r[e];n.removeChild(t)}return o})(e);if(d)f.response=o,v?.("response",o);else{const e=[],t=o.content.childNodes;if(s)k(o,!1);else{const o=n.parentNode;for(let r=0;r<t.length;r++){const s=t[r],i=o.insertBefore(s,n);c&&e.push(i)}o.removeChild(n),c&&(u.response=e,v?.("response",e,u)),v?.("response",r)}}}})).catch((e=>{throw A||P("rejected"),e}))},f=e=>{var o;e.get&&(o=e.get,"[object Function]"!==Object.prototype.toString.call(o)&&t("The get property has a function value"))};return{compile:o=>{"string"!=typeof o&&t("template was not found or the type of the passed value is not string"),o||t("template empty");const u=[],h=o.split(d).filter(Boolean);let g,y,m=-1,v="";for(let e=0;e<h.length;e++){const o=h[e],d="}"===o;if("{"===o)m>1&&t("Object nesting error"),-1===m?y={startId:e,endId:NaN}:y&&(v+=o),m++,g=!0;else if(d)if(g&&0===m&&t("There are no query objects between the brackets"),-1===m)t("Template error");else if(-1==--m&&void 0!==g){const o=e=>e=(e=e.trim()).replace(/\r?\n|\r/g,""),d=o(v),c=JSON.parse(d);for(const e in c){const o=c[e];switch("src"!==e&&e!==n&&e!==r&&e!==s&&e!==i&&e!==l&&t(`Property ${e} is not processed`),e){case l:Array.isArray(o)||t(`The value of the property ${e} must be an array`);break;case r:"string"!=typeof o&&"number"!=typeof o&&t(`The value of the property ${e} must be a string`);break;case i:"boolean"!=typeof o&&t(`The value of the property ${e} must be a boolean value`);break;default:"string"!=typeof o&&t(`The value of the property ${e} must be a string`)}}y.endId=e;const a={...c,...y};u.push(a),g=void 0,y=void 0,v=""}else y&&(v+=o),g=!1;else y&&(v+=o)}0===u.length&&t("Request not found");let b=0;for(let e=0;e<u.length;e++){const t=u[e],o=`\x3c!--hmpl${e}--\x3e`,{startId:n,endId:r}=t,s=r-n;h.splice(n-b,s+1,o),b+=r-n,delete t.startId,delete t.endId}o=h.join("");let N=!1;const T=(e=>{const o=a(e);o.content.children.length>1&&t('Template include only one node with type "Element" or "Comment"');const n=e=>{switch(e.nodeType){case Node.ELEMENT_NODE:if("pre"===e.tagName)return;break;case Node.TEXT_NODE:if(!/\S/.test(e.textContent))return void e.remove()}for(let t=0;t<e.childNodes.length;t++)n(e.childNodes.item(t))};n(o.content.childNodes[0]);let r=o.content.firstElementChild;if(!r){const e=o.content.firstChild,n=8===e?.nodeType;n?(N=n,r=e):t("Element is undefined")}return r})(o);return((e,o,r,l=!1)=>{const d=(e,o)=>{const r=e.src;if(r){const d=(e.method||"GET").toLowerCase();if(!(e=>"get"!==e&&"post"!==e&&"put"!==e&&"delete"!==e&&"patch"!==e)(d)){const n=e.after;n&&l&&t("EventTarget is undefined");const f=!e.hasOwnProperty("isRepeatable");f||"boolean"==typeof e.isRepeatable||t(`${i} has only boolean value`);const u=f||e.isRepeatable?"all":"one",h=e.initId,g="all"===u,y=e.nodeId;let m=e.indicators;if(m){const e=e=>{const{trigger:o,content:n}=e;o||t("Indicator trigger error"),n||t("Indicator content error"),-1===c.indexOf(o)&&"pending"!==o&&"rejected"!==o&&"error"!==o&&t("Indicator trigger error");const r=a(n);return{...e,content:r}},o={},n=[];for(let r=0;r<m.length;r++){const s=e(m[r]),{trigger:i}=s;-1===n.indexOf(i)?n.push(i):t("Indicator trigger must be unique"),o[`${i}`]=s.content}m=o}const v=(e,o=!1)=>{if(o){if(h){let o;for(let t=0;t<e.length;t++){const n=e[t];if(n.id===h){o=n.value;break}}return o||t("id referenced by request not found"),o}return{}}return h&&t("id referenced by request not found"),e},b=g&&n,N=(e,n,s,i,c,a=!1,f,u=!1,h)=>{const g=i.currentId;if(l)e||(e=o);else if(!e)if(h)e=h.el;else{let o;const{els:n}=i;for(let e=0;e<n.length;e++){const t=n[e];if(t.id===y){h=t,o=t.el;break}}o||t("Element error"),e=o}let N;l||(b||m)&&(h||t("Element error"),N=h.objNode,N||(N={id:g,nodes:null,parentNode:null,comment:e},h.objNode=N,i.dataObjects.push(N),i.currentId++));const T=v(n,a);p(e,c,N,d,r,l,u,T,s,f,m)};let T=N;if(n){const e=(e,o,n,r,s,i,l,d,c,a,p)=>{const f=c.querySelectorAll(n);0===f.length&&t("Selectors nodes not found");const u=g?()=>{N(e,r,s,i,c,l,a,d,p)}:()=>{N(e,r,s,i,c,l,a,d,p);for(let e=0;e<f.length;e++)f[e].removeEventListener(o,u)};for(let e=0;e<f.length;e++)f[e].addEventListener(o,u)};if(n.indexOf(":")>0){const t=n.split(":"),o=t[0],r=t.slice(1).join(":");T=(t,n,s,i,l,d=!1,c,a=!1,p)=>{e(t,o,r,n,s,i,d,a,l,c,p)}}else t(`${s} property doesn't work without EventTargets`)}else f||t(`${i} property doesn't work without ${s}`);return T}t(`${n} has only GET, POST, PUT, PATCH or DELETE values`)}else t('The "source" property are not found or empty')};let f;if(l)r[0].el=e,f=d(r[0]);else{let o=-2;const n=e=>{if(o++,8==e.nodeType){let n=e.nodeValue;if(n&&n.startsWith("hmpl")){n=n.slice(4);const s=Number(n),i=r[s];(Number.isNaN(s)||void 0===i)&&t("Request index error"),i.el=e,i.nodeId=o}}if(e.hasChildNodes()){const t=e.childNodes;for(let e=0;e<t.length;e++)n(t[e])}};n(e);const s=[];for(let t=0;t<r.length;t++){const o=r[t];s.push(d(o,e))}if(r.length>1)f=(e,o,n,r,i,l=!1)=>{e||(e=i);const d=[],c=r.els;for(let i=0;i<c.length;i++){const a=c[i],p=a.el;null===p.parentNode&&t('"parentNode" is null');const f={response:void 0};(0,s[i])(p,o,n,r,e,l,f,!0,a),d.push(f)}n.requests=d};else{const o=r[0];null===o.el.parentNode&&t('"parentNode" is null'),f=d(o,e)}}return o(f)})(T,(o=>(n={})=>{const r=T.cloneNode(!0),s={response:N?void 0:r},i={dataObjects:[],els:[],currentId:0};if(!N){let e=-2;const t=o=>{if(e++,8==o.nodeType){const t=o.nodeValue;if(t&&t.startsWith("hmpl")){const t={el:o,id:e};i.els.push(t)}}if(o.hasChildNodes()){const e=o.childNodes;for(let o=0;o<e.length;o++)t(e[o])}};t(r)}return e(n)?(f(n),o(void 0,n,s,i,r)):Array.isArray(n)&&((o=>{const n=[];for(let r=0;r<o.length;r++){const s=o[r];e(s)||t('options is of type "object"'),f(s);const{id:i}=s;"string"!=typeof s.id&&"number"!=typeof s.id&&t('Id must be a "string" or a "number".'),n.indexOf(i)>-1?t(`id with value "${i}" already exists`):n.push(i)}})(n),o(void 0,n,s,i,r,!0)),s}),u,N)},stringify:e=>JSON.stringify(e)}}()}));