!function(e,t){"object"==typeof module&&module.exports?module.exports=t():"function"==typeof define&&define.amd?define([],t):e.hmpl=e.hmpl||t()}("undefined"!=typeof self?self:this,(function(){return function(){"use strict";const e=e=>"object"==typeof e&&!Array.isArray(e)&&null!==e,t=e=>{throw new Error(e)},o=e=>{console.warn(e)},n="method",s="initId",r="after",i="repeat",l="memo",d="indicators",c="hmpl",a=/([{}])/,p=[100,101,102,103,300,301,302,303,304,305,306,307,308,400,401,402,403,404,405,406,407,408,409,410,411,412,413,414,415,416,417,418,421,422,423,424,425,426,428,429,431,451,500,501,502,503,504,505,506,507,508,510,511],f=e=>(new DOMParser).parseFromString(`<template>${e}</template>`,"text/html").childNodes[0].childNodes[0].firstChild,u=(n,s,r,i,l,d,c,a,p={},u,m,h)=>{const{mode:g,cache:y,redirect:v,get:b,referrerPolicy:N,signal:w,credentials:T,timeout:E,referrer:j,headers:I,body:P,window:O,integrity:$}=p,C={method:i.toUpperCase()};void 0!==T&&(C.credentials=T),void 0!==P&&(C.body=P),void 0!==g&&(C.mode=g),void 0!==y&&(C.cache=y),void 0!==v&&(C.redirect=v),void 0!==N&&(C.referrerPolicy=N),void 0!==$&&(C.integrity=$),void 0!==j&&(C.referrer=j);const k=void 0!==w;if(k&&(C.signal=w),void 0!==O&&(C.window=O),void 0!==p.keepalive&&o("keepalive property is not yet supported"),I)if(e(I)){const e=new Headers;for(const o in I){const[n,s]=o;if("string"==typeof s)try{e.set(n,s)}catch(e){throw e}else t("Header has no string value")}C.headers=e}else t('The "header" property does not have a value object');E&&(k?o("The signal property overwrote the AbortSignal from timeout"):C.signal=AbortSignal.timeout(E));const x=a&&!d&&r?.memo,A=e=>"rejected"===e||"number"==typeof e&&(e<200||e>299),S=e=>{c&&(m.response=e,b?.("response",e,m)),b?.("response",s)},q=(e,o=!0,s=!1)=>{if(d)u.response=e.cloneNode(!0),b?.("response",e);else{let i=[];const l=(o?e.cloneNode(!0):e).content.childNodes;if(r.nodes){const e=r.parentNode;e||t("parentNode is null");const o=[],n=r.nodes.length;for(let t=0;t<n;t++){const s=r.nodes[t];if(t===n-1)for(let t=0;t<l.length;t++){const n=l[t],r=e.insertBefore(n,s);o.push(r)}e.removeChild(s)}i=o.slice(),r.nodes=o}else{const e=n.parentNode,t=[];for(let o=0;o<l.length;o++){const s=l[o],r=e.insertBefore(s,n);t.push(r)}e.removeChild(n),i=t.slice(),r.nodes=t,r.parentNode=e}x&&s&&(r.memo.nodes=r.nodes,r.memo.isPending&&(r.memo.isPending=!1)),S(i)}};let B=!1,L=!1;const D=()=>{if(d)u.response=void 0,b?.("response",void 0);else if(r.nodes){const e=r.parentNode;e||t("parentNode is null");const o=r.nodes.length;for(let t=0;t<o;t++){const n=r.nodes[t];t===o-1&&e.insertBefore(r.comment,n),e.removeChild(n)}r.nodes=null,r.parentNode=null,c&&(m.response=void 0,b?.("response",void 0,m)),b?.("response",s)}x&&null!==r.memo.response&&(r.memo.response=null,delete r.memo.isPending,delete r.memo.nodes)},H=e=>{c?m.status!==e&&(m.status=e,b?.("status",e,m)):u.status!==e&&(u.status=e,b?.("status",e)),x&&A(e)&&(r.memo.response=null,delete r.memo.nodes),(e=>{if(h)if(x&&"pending"!==e&&A(e)&&r.memo.isPending&&(r.memo.isPending=!1),"pending"===e){const e=h.pending;void 0!==e&&(x&&(r.memo.isPending=!0),q(e))}else if("rejected"===e){const e=h.rejected;if(void 0!==e)q(e);else{const e=h.error;void 0!==e?q(e):D()}}else{const t=h[`${e}`];if(e>399)if(B=!0,void 0!==t)q(t);else{const e=h.error;void 0!==e?q(e):D()}else(e<200||e>299)&&(L=!0,void 0!==t?q(t):D())}})(e)};let R=200;H("pending"),fetch(l,C).then((e=>(R=e.status,H(R),e.ok||t(`Request error with code ${R}`),e.text()))).then((e=>{if(!L)if(A(R))D();else{if(x){const{response:o}=r.memo;if(null===o)r.memo.response=e;else{if(o===e)return void(()=>{if(r.memo.isPending){const e=r.parentNode;e||t("parentNode is null");const o=r.memo.nodes,n=r.nodes,s=n.length,i=[];for(let t=0;t<s;t++){const r=n[t];if(t===s-1)for(let t=0;t<o.length;t++){const n=o[t],s=e.insertBefore(n,r);i.push(s)}e.removeChild(r)}r.nodes=i.slice(),r.memo.isPending=!1,r.memo.nodes=i.slice()}const e=r.nodes.slice();S(e)})();r.memo.response=e,delete r.memo.nodes}}const o=(e=>{"string"!=typeof e&&t("Bad response");const o=f(e),n=o.content,s=n.querySelectorAll("script");for(let e=0;e<s.length;e++){const t=s[e];n.removeChild(t)}return o})(e);if(d)u.response=o,b?.("response",o);else{const e=[],t=o.content.childNodes;if(r)q(o,!1,!0);else{const o=n.parentNode;for(let s=0;s<t.length;s++){const r=t[s],i=o.insertBefore(r,n);c&&e.push(i)}o.removeChild(n),c&&(m.response=e,b?.("response",e,m)),b?.("response",s)}}}})).catch((e=>{throw B||(H("rejected"),h||D()),e}))},m=e=>{var o;e.get&&(o=e.get,"[object Function]"!==Object.prototype.toString.call(o)&&t("The get property has a function value"))};return{compile:(o,h={})=>{"string"!=typeof o&&t("template was not found or the type of the passed value is not string"),o||t("template empty"),e(h)||t("Options must be an object");const g=!h.hasOwnProperty(l);g||"boolean"==typeof h[l]||t(`The value of the property ${l} must be a boolean value`);const y=[],v=o.split(a).filter(Boolean);let b,N,w=-1,T="";for(let e=0;e<v.length;e++){const o=v[e],c="}"===o;if("{"===o)w>1&&t("Object nesting error"),-1===w?N={startId:e,endId:NaN}:N&&(T+=o),w++,b=!0;else if(c)if(b&&0===w&&t("There are no query objects between the brackets"),-1===w)t("Template error");else if(-1==--w&&void 0!==b){const o=e=>e=(e=e.trim()).replace(/\r?\n|\r/g,""),c=o(T),a=JSON.parse(c);for(const e in a){const o=a[e];switch("src"!==e&&e!==n&&e!==s&&e!==r&&e!==i&&e!==d&&e!==l&&t(`Property ${e} is not processed`),e){case d:Array.isArray(o)||t(`The value of the property ${e} must be an array`);break;case s:"string"!=typeof o&&"number"!=typeof o&&t(`The value of the property ${e} must be a string`);break;case l:case i:"boolean"!=typeof o&&t(`The value of the property ${e} must be a boolean value`);break;default:"string"!=typeof o&&t(`The value of the property ${e} must be a string`)}}N.endId=e;const p={...a,...N};y.push(p),b=void 0,N=void 0,T=""}else N&&(T+=o),b=!1;else N&&(T+=o)}0===y.length&&t("Request not found");let E=0;for(let e=0;e<y.length;e++){const t=y[e],o=`\x3c!--hmpl${e}--\x3e`,{startId:n,endId:s}=t,r=s-n;v.splice(n-E,r+1,o),E+=s-n,delete t.startId,delete t.endId}o=v.join("");let j=!1;const I=(e=>{const o=f(e);o.content.children.length>1&&t('Template include only one node with type "Element" or "Comment"');const n=e=>{switch(e.nodeType){case Node.ELEMENT_NODE:if("pre"===e.tagName)return;break;case Node.TEXT_NODE:if(!/\S/.test(e.textContent))return void e.remove()}for(let t=0;t<e.childNodes.length;t++)n(e.childNodes.item(t))};n(o.content.childNodes[0]);let s=o.content.firstElementChild;if(!s){const e=o.content.firstChild,n=8===e?.nodeType;n?(j=n,s=e):t("Element is undefined")}return s})(o);return((e,o,s,d,a,m=!1)=>{const h=(e,o)=>{const s=e.src;if(s){const c=(e.method||"GET").toLowerCase();if(!(e=>"get"!==e&&"post"!==e&&"put"!==e&&"delete"!==e&&"patch"!==e)(c)){const n=e.after;n&&m&&t("EventTarget is undefined");const h=!e.hasOwnProperty(i);h||"boolean"==typeof e.repeat||t(`${i} has only boolean value`);const g="all"==(h||e.repeat?"all":"one"),y=!e.hasOwnProperty(l);let v=!a&&d.memo;y?v&&(n&&g||(v=!1)):n?e.memo?g?v=!0:t("memoization works in the enabled repetition mode"):v=!1:t("memoization works in the enabled repetition mode");const b=e.initId,N=e.nodeId;let w=e.indicators;if(w){const e=e=>{const{trigger:o,content:n}=e;o||t("Indicator trigger error"),n||t("Indicator content error"),-1===p.indexOf(o)&&"pending"!==o&&"rejected"!==o&&"error"!==o&&t("Indicator trigger error");const s=f(n);return{...e,content:s}},o={},n=[];for(let s=0;s<w.length;s++){const r=e(w[s]),{trigger:i}=r;-1===n.indexOf(i)?n.push(i):t("Indicator trigger must be unique"),o[`${i}`]=r.content}w=o}const T=(e,o=!1)=>{if(o){if(b){let o;for(let t=0;t<e.length;t++){const n=e[t];if(n.id===b){o=n.value;break}}return o||t("id referenced by request not found"),o}return{}}return b&&t("id referenced by request not found"),e},E=g&&n,j=(e,n,r,i,l,d=!1,a,p=!1,f)=>{const h=i.currentId;if(m)e||(e=o);else if(!e)if(f)e=f.el;else{let o;const{els:n}=i;for(let e=0;e<n.length;e++){const t=n[e];if(t.id===N){f=t,o=t.el;break}}o||t("Element error"),e=o}let g;m||(E||w)&&(f||t("Element error"),g=f.objNode,g||(g={id:h,nodes:null,parentNode:null,comment:e},v&&(g.memo={response:null},w&&(g.memo.isPending=!1)),f.objNode=g,i.dataObjects.push(g),i.currentId++));const y=T(n,d);u(e,l,g,c,s,m,p,v,y,r,a,w)};let I=j;if(n){const e=(e,o,n,s,r,i,l,d,c,a,p)=>{const f=c.querySelectorAll(n);0===f.length&&t("Selectors nodes not found");const u=g?()=>{j(e,s,r,i,c,l,a,d,p)}:()=>{j(e,s,r,i,c,l,a,d,p);for(let e=0;e<f.length;e++)f[e].removeEventListener(o,u)};for(let e=0;e<f.length;e++)f[e].addEventListener(o,u)};if(n.indexOf(":")>0){const t=n.split(":"),o=t[0],s=t.slice(1).join(":");I=(t,n,r,i,l,d=!1,c,a=!1,p)=>{e(t,o,s,n,r,i,d,a,l,c,p)}}else t(`${r} property doesn't work without EventTargets`)}else h||t(`${i} property doesn't work without ${r}`);return I}t(`${n} has only GET, POST, PUT, PATCH or DELETE values`)}else t('The "source" property are not found or empty')};let g;if(m)s[0].el=e,g=h(s[0]);else{let o=-2;const n=e=>{if(o++,8==e.nodeType){let n=e.nodeValue;if(n&&n.startsWith(c)){n=n.slice(4);const r=Number(n),i=s[r];(Number.isNaN(r)||void 0===i)&&t("Request index error"),i.el=e,i.nodeId=o}}if(e.hasChildNodes()){const t=e.childNodes;for(let e=0;e<t.length;e++)n(t[e])}};n(e);const r=[];for(let t=0;t<s.length;t++){const o=s[t];r.push(h(o,e))}if(s.length>1)g=(e,o,n,s,i,l=!1)=>{e||(e=i);const d=[],c=s.els;for(let i=0;i<c.length;i++){const a=c[i],p=a.el;null===p.parentNode&&t('"parentNode" is null');const f={response:void 0};(0,r[i])(p,o,n,s,e,l,f,!0,a),d.push(f)}n.requests=d};else{const o=s[0];null===o.el.parentNode&&t('"parentNode" is null'),g=h(o,e)}}return o(g)})(I,(o=>(n={})=>{const s=I.cloneNode(!0),r={response:j?void 0:s},i={dataObjects:[],els:[],currentId:0};if(!j){let e=-2;const t=o=>{if(e++,8==o.nodeType){const t=o.nodeValue;if(t&&t.startsWith(c)){const t={el:o,id:e};i.els.push(t)}}if(o.hasChildNodes()){const e=o.childNodes;for(let o=0;o<e.length;o++)t(e[o])}};t(s)}return e(n)?(m(n),o(void 0,n,r,i,s)):Array.isArray(n)&&((o=>{const n=[];for(let s=0;s<o.length;s++){const r=o[s];e(r)||t('options is of type "object"'),m(r);const{id:i}=r;"string"!=typeof r.id&&"number"!=typeof r.id&&t('Id must be a "string" or a "number".'),n.indexOf(i)>-1?t(`id with value "${i}" already exists`):n.push(i)}})(n),o(void 0,n,r,i,s,!0)),r}),y,h,g,j)},stringify:e=>JSON.stringify(e)}}()}));