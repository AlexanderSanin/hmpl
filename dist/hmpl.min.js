!function(e,t){"object"==typeof module&&module.exports?module.exports=t():"function"==typeof define&&define.amd?define([],t):e.hmpl=e.hmpl||t()}("undefined"!=typeof self?self:this,(function(){return function(){"use strict";const e=e=>"object"==typeof e&&!Array.isArray(e)&&null!==e,t=e=>{throw new Error(e)},o=e=>{console.warn(e)},n="REQUEST",s="method",r="after",l="mode",i=(n,s,r,l,i,d,c,a={},u,f)=>{const{mode:h,cache:p,redirect:g,get:m,referrerPolicy:y,signal:N,credentials:v,timeout:E,referrer:b,headers:w,body:T,window:A,integrity:O}=a,C={method:l.toUpperCase()};void 0!==v&&(C.credentials=v),void 0!==T&&(C.body=T),void 0!==h&&(C.mode=h),void 0!==p&&(C.cache=p),void 0!==g&&(C.redirect=g),void 0!==y&&(C.referrerPolicy=y),void 0!==O&&(C.integrity=O),void 0!==b&&(C.referrer=b);const S=void 0!==N;if(S&&(C.signal=N),void 0!==A&&(C.window=A),void 0!==a.keepalive&&o("keepalive property is not yet supported"),w)if(e(w)){const e=new Headers;for(const o in w){const[n,s]=o;if("string"==typeof s)try{e.set(n,s)}catch(e){throw e}else t("Header has no string value")}C.headers=e}else t('The "header" property does not have a value object');E&&(S?o("The signal property overwrote the AbortSignal from timeout"):C.signal=AbortSignal.timeout(E));const j=e=>{c?f.status!==e&&(f.status=e,m?.("status",e,f)):u.status!==e&&(u.status=e,m?.("status",e))};j(0),fetch(i,C).then((e=>(j(e.status),e.ok||t(`Request error with code ${e.status}`),e.text()))).then((e=>{const o=(e=>{"string"!=typeof e&&t("Bad response");const o=(new DOMParser).parseFromString(`<template>${e}</template>`,"text/html").childNodes[0].childNodes[0].firstChild,n=o.content,s=n.querySelectorAll("script");for(let e=0;e<s.length;e++){const t=s[e];n.removeChild(t)}return o})(e);if(d)u.response=o,m?.("response",o);else{let e=[];const l=o.content.childNodes;if(r)if(r.nodes){const o=r.parentNode;o||t("parentNode is null");const n=[],s=r.nodes.length;for(let e=0;e<s;e++){const t=r.nodes[e];if(e===s-1)for(let e=0;e<l.length;e++){const s=l[e],r=o.insertBefore(s,t);n.push(r)}o.removeChild(t)}e=n.slice(),r.nodes=n}else{const t=n.parentNode,o=[];for(let e=0;e<l.length;e++){const s=l[e],r=t.insertBefore(s,n);o.push(r)}t.removeChild(n),e=o.slice(),r.nodes=o,r.parentNode=t}else{const t=n.parentNode;for(let o=0;o<l.length;o++){const s=l[o],r=t.insertBefore(s,n);c&&e.push(r)}t.removeChild(n)}c&&(f.response=e,m?.("response",e,f)),m?.("response",s)}})).catch((e=>{throw e}))},d=e=>{var o;e.get&&(o=e.get,"[object Function]"!==Object.prototype.toString.call(o)&&t("The get property has a function value"))};return{compile:o=>{"string"!=typeof o&&t("template was not found or the type of the passed value is not string"),o||t("template empty");const c=(e=>{const o=(new DOMParser).parseFromString(`<template>${e}</template>`,"text/html").childNodes[0].childNodes[0].firstChild;o.content.children.length>1&&t("Template include only one node with type 'Element'");const n=e=>{switch(e.nodeType){case Node.ELEMENT_NODE:if("pre"===e.tagName)return;break;case Node.TEXT_NODE:if(!/\S/.test(e.textContent))return void e.remove()}for(let t=0;t<e.childNodes.length;t++)n(e.childNodes.item(t))};n(o.content.childNodes[0]);const s=o.content.firstElementChild;return s||t("Element is undefined"),s})(o),a=c.nodeName===n;return((e,o,d=!1)=>{const c=(e,o)=>{const n=e.getAttribute("src");if(n){const c=(e.getAttribute(s)||"GET").toLowerCase();if(!(e=>"get"!==e&&"post"!==e&&"put"!==e&&"delete"!==e&&"patch"!==e)(c)){const s=e.getAttribute(r);s&&d&&t("EventTarget is undefined");const a=e.getAttribute(l),u=(a||"all").toLowerCase();"one"!==u&&"all"!==u&&t(`${l} has only ONE or ALL values`);const f=e.getAttribute("ref"),h="all"===u;let p=-1;if(o){let t=-2;const n=o=>{if(t++,o===e)return p=t,!0;for(let e=0;e<o.childNodes.length;e++){const t=o.childNodes.item(e);if(t.nodeType===Node.ELEMENT_NODE&&n(t))break}};n(o)}const g=(e,o=!1)=>{if(o){if(f){let o;for(let t=0;t<e.length;t++){const n=e[t];if(n.id===f){o=n.options;break}}return o||t("id referenced by request not found"),o}return{}}return f&&t("id referenced by request not found"),e},m=h&&s,y=(e,s,r,l,a,u=!1,f,h=!1,y)=>{const N=l.currentId;if(d)e||(e=o);else if(!e)if(y)e=y.el;else{let o;const{els:n}=l;for(let e=0;e<n.length;e++){const t=n[e];if(t.id===p){y=t,o=t.el;break}}o||t("Element error"),e=o}let v;m&&(y||t("Element error"),v=y.objNode,v||(v={id:N,nodes:null,parentNode:null},y.objNode=v,l.dataObjects.push(v),l.currentId++));const E=g(s,u);i(e,a,v,c,n,d,h,E,r,f)};let N=y;if(s){const e=(e,o,n,s,r,l,i,d,c,a,u)=>{const f=c.querySelectorAll(n);0===f.length&&t("Selectors nodes not found");const p=h?()=>{y(e,s,r,l,c,i,a,d,u)}:()=>{y(e,s,r,l,c,i,a,d,u);for(let e=0;e<f.length;e++)f[e].removeEventListener(o,p)};for(let e=0;e<f.length;e++)f[e].addEventListener(o,p)};if(s.indexOf(":")>0){const t=s.split(":"),o=t[0],n=t.slice(1).join(":");N=(t,s,r,l,i,d=!1,c,a=!1,u)=>{const f=g(s,d);e(t,o,n,f,r,l,d,a,i,c,u)}}else t(`${r} attribute doesn't work without EventTargets`)}else a&&t(`${l} attribute doesn't work without ${r}`);return N}t(`${s} has only GET, POST, PUT, PATCH or DELETE values`)}else t('The "source" attribute are not found or empty')};let a;if(d)a=c(e);else{const o=e.querySelectorAll(`${n}`);0===o.length&&t(`${n} not found`);const s=[];for(let t=0;t<o.length;t++){const n=o[t];s.push(c(n,e))}if(o.length>1)a=(e,o,n,r,l,i=!1)=>{e||(e=l);const d=[],c=r.els;for(let l=0;l<c.length;l++){const a=c[l],u=a.el;null===u.parentNode&&t('"parentNode" is null');const f={response:void 0,status:0};(0,s[l])(u,o,n,r,e,i,f,!0,a),d.push(f)}n.requests=d};else{const n=o[0];null===n.parentNode&&t('"parentNode" is null'),a=c(n,e)}}return o(a)})(c,(o=>(s={})=>{const r=c.cloneNode(!0),l={response:a?void 0:r};a&&(l.status=0);const i={dataObjects:[],els:[],currentId:0};if(!a){let e=-2;const t=o=>{if(e++,o.nodeName===n){const t={el:o,id:e};i.els.push(t)}else for(let e=0;e<o.childNodes.length;e++){const n=o.childNodes.item(e);n.nodeType===Node.ELEMENT_NODE&&t(n)}};t(r)}return e(s)?(d(s),o(void 0,s,l,i,r)):Array.isArray(s)&&((o=>{const n=[];for(let s=0;s<o.length;s++){const r=o[s];e(r)||t('options is of type "object"'),d(r);const{id:l}=r;"string"!=typeof r.id&&t('id is of type "string"'),n.indexOf(l)>-1?t(`id with value "${l}" already exists`):n.push(l)}})(s),o(void 0,s,l,i,r,!0)),l}),a)}}}()}));