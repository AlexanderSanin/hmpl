!function(e,t){"object"==typeof module&&module.exports?module.exports=t():"function"==typeof define&&define.amd?define([],t):e.hmpl=e.hmpl||t()}("undefined"!=typeof self?self:this,(function(){return function(){"use strict";const e=e=>"object"==typeof e&&!Array.isArray(e)&&null!==e,t=e=>{throw new Error(e)},o="REQUEST",n="method",s="after",r="mode",l=(o,n,s,r,l,i,d,c={},a,u)=>{const{mode:f,cache:h,redirect:p,get:g,referrerPolicy:m,credentials:y,timeout:N,headers:v,body:b}=c,E={method:r.toUpperCase()};if(void 0!==y&&(E.credentials=y),void 0!==b&&(E.body=b),void 0!==f&&(E.mode=f),void 0!==h&&(E.cache=h),void 0!==p&&(E.redirect=p),void 0!==m&&(E.referrerPolicy=m),v)if(e(v)){const e=new Headers;for(const o in v){const[n,s]=o;if("string"==typeof s)try{e.set(n,s)}catch(e){throw e}else t("Header has no string value")}E.headers=e}else t('The "header" property does not have a value object');N&&(E.signal=AbortSignal.timeout(N));const w=e=>{d?u.status!==e&&(u.status=e,g?.("status",e,u)):a.status!==e&&(a.status=e,g?.("status",e))};w(0),fetch(l,E).then((e=>(w(e.status),e.ok||t(`Request error with code ${e.status}`),e.text()))).then((e=>{const r=(e=>{"string"!=typeof e&&t("Bad response");const o=(new DOMParser).parseFromString(`<template>${e}</template>`,"text/html").childNodes[0].childNodes[0].firstChild,n=o.content,s=n.querySelectorAll("script");for(let e=0;e<s.length;e++){const t=s[e];n.removeChild(t)}return o})(e);if(i)a.response=r,g?.("response",r);else{let e=[];const l=r.content.childNodes;if(s)if(s.nodes){const o=s.parentNode;o||t("parentNode is null");const n=[],r=s.nodes.length;for(let e=0;e<r;e++){const t=s.nodes[e];if(e===r-1)for(let e=0;e<l.length;e++){const s=l[e],r=o.insertBefore(s,t);n.push(r)}o.removeChild(t)}e=n.slice(),s.nodes=n}else{const t=o.parentNode,n=[];for(let e=0;e<l.length;e++){const s=l[e],r=t.insertBefore(s,o);n.push(r)}t.removeChild(o),e=n.slice(),s.nodes=n,s.parentNode=t}else{const t=o.parentNode;for(let n=0;n<l.length;n++){const s=l[n],r=t.insertBefore(s,o);d&&e.push(r)}t.removeChild(o)}d&&(u.response=e,g?.("response",e,u)),g?.("response",n)}})).catch((e=>{throw e}))},i=e=>{var o;e.get&&(o=e.get,"[object Function]"!==Object.prototype.toString.call(o)&&t("The get property has a function value"))};return{compile:d=>{"string"!=typeof d&&t("template was not found or the type of the passed value is not string");const c=(e=>{const o=(new DOMParser).parseFromString(`<template>${e}</template>`,"text/html").childNodes[0].childNodes[0].firstChild;o.content.children.length>1&&t("Template include only one node with type 'Element'");const n=e=>{switch(e.nodeType){case Node.ELEMENT_NODE:if("pre"===e.tagName)return;break;case Node.TEXT_NODE:if(!/\S/.test(e.textContent))return void e.remove()}for(let t=0;t<e.childNodes.length;t++)n(e.childNodes.item(t))};n(o.content.childNodes[0]);const s=o.content.firstElementChild;return s||t("Element is undefined"),s})(d),a=c.nodeName===o;return((e,i,d=!1)=>{const c=(e,o)=>{const i=e.getAttribute("src");if(i){const c=(e.getAttribute(n)||"GET").toLowerCase();if(!(e=>"get"!==e&&"post"!==e&&"put"!==e&&"delete"!==e&&"patch"!==e)(c)){const n=e.getAttribute(s);n&&d&&t("EventTarget is undefined");const a=e.getAttribute(r),u=(a||"all").toLowerCase();"one"!==u&&"all"!==u&&t(`${r} has only ONE or ALL values`);const f=e.getAttribute("ref"),h="all"===u;let p=-1;if(o){const t=o.childNodes;for(let o=0;o<t.length;o++)if(t[o]===e){p=o;break}}const g=(e,o=!1)=>{if(o){if(f){let o;for(let t=0;t<e.length;t++){const n=e[t];if(n.id===f){o=n.options;break}}return o||t("id referenced by request not found"),o}return{}}return f&&t("id referenced by request not found"),e},m=h&&n,y=(e,n,s,r,a,u=!1,f,h=!1,y)=>{const N=r.currentId;if(d)e||(e=o);else if(!e)if(y)e=y.el;else{let o;const{els:n}=r;for(let e=0;e<n.length;e++){const t=n[e];if(t.id===p){y=t,o=t.el;break}}o||t("Element error"),e=o}let v;m&&(y||t("Element error"),v=y.objNode,v||(v={id:N,nodes:null,parentNode:null},y.objNode=v,r.dataObjects.push(v),r.currentId++));const b=g(n,u);l(e,a,v,c,i,d,h,b,s,f)};let N=y;if(n){const e=(e,t,o,n,s,r,l,i,d,c,a)=>{const u=d.querySelectorAll(o),f=h?()=>{y(e,n,s,r,d,l,c,i,a)}:()=>{y(e,n,s,r,d,l,c,i,a);for(let e=0;e<u.length;e++)u[e].removeEventListener(t,f)};for(let e=0;e<u.length;e++)u[e].addEventListener(t,f)};if(n.indexOf(":")>0){const t=n.split(":"),o=t[0],s=t.slice(1).join(":");N=(t,n,r,l,i,d=!1,c,a=!1,u)=>{const f=g(n,d);e(t,o,s,f,r,l,d,a,i,c,u)}}else t(`${s} attribute doesn't work without EventTargets`)}else a&&t(`${r} attribute doesn't work without ${s}`);return N}t(`${n} has only GET, POST, PUT, PATCH or DELETE values`)}else t('The "source" attribute are not found or empty')};let a;if(d)a=c(e);else{const n=e.querySelectorAll(`${o}`),s=[];for(let t=0;t<n.length;t++){const o=n[t];s.push(c(o,e))}if(n.length>1)a=(e,o,n,r,l,i=!1)=>{e||(e=l);const d=[],c=r.els;for(let l=0;l<c.length;l++){const a=c[l],u=a.el;null===u.parentNode&&t('"parentNode" is null');const f={response:void 0,status:0};(0,s[l])(u,o,n,r,e,i,f,!0,a),d.push(f)}n.requests=d};else{const o=n[0];null===o.parentNode&&t('"parentNode" is null'),a=c(o,e)}}return i(a)})(c,(n=>(s={})=>{const r=c.cloneNode(!0),l={response:a?void 0:r};a&&(l.status=0);const d={dataObjects:[],els:[],currentId:0};if(!a){const e=r.childNodes;for(let t=0;t<e.length;t++){const n=e[t];if(n.nodeName===o){const e={el:n,id:t};d.els.push(e)}}}return e(s)?(i(s),n(void 0,s,l,d,r)):Array.isArray(s)&&((o=>{const n=[];for(let s=0;s<o.length;s++){const r=o[s];e(r)||t('options is of type "object"'),i(r);const{id:l}=r;"string"!=typeof r.id&&t('id is of type "string"'),n.indexOf(l)>-1?t(`id with value "${l}" already exists`):n.push(l)}})(s),n(void 0,s,l,d,r,!0)),l}),a)}}}()}));