!function(e,t){"object"==typeof module&&module.exports?module.exports=t():"function"==typeof define&&define.amd?define([],t):e.hmpl=e.hmpl||t()}("undefined"!=typeof self?self:this,(function(){return function(){"use strict";const e=e=>"object"==typeof e&&!Array.isArray(e)&&null!==e,t=e=>{throw new Error(e)},o=e=>{console.warn(e)},n="method",r="after",s="mode",i=/([{}])/,l=[100,101,102,103,300,301,302,303,304,305,306,307,308,400,401,402,403,404,405,406,407,408,409,410,411,412,413,414,415,416,417,418,421,422,423,424,425,426,428,429,431,451,500,501,502,503,504,505,506,507,508,510,511],d=e=>(new DOMParser).parseFromString(`<template>${e}</template>`,"text/html").childNodes[0].childNodes[0].firstChild,c=(n,r,s,i,l,c,a,f={},u,h,p)=>{const{mode:g,cache:m,redirect:y,get:v,referrerPolicy:N,signal:b,credentials:w,timeout:T,referrer:E,headers:C,body:I,window:j,integrity:O}=f,$={method:i.toUpperCase()};void 0!==w&&($.credentials=w),void 0!==I&&($.body=I),void 0!==g&&($.mode=g),void 0!==m&&($.cache=m),void 0!==y&&($.redirect=y),void 0!==N&&($.referrerPolicy=N),void 0!==O&&($.integrity=O),void 0!==E&&($.referrer=E);const x=void 0!==b;if(x&&($.signal=b),void 0!==j&&($.window=j),void 0!==f.keepalive&&o("keepalive property is not yet supported"),C)if(e(C)){const e=new Headers;for(const o in C){const[n,r]=o;if("string"==typeof r)try{e.set(n,r)}catch(e){throw e}else t("Header has no string value")}$.headers=e}else t('The "header" property does not have a value object');T&&(x?o("The signal property overwrote the AbortSignal from timeout"):$.signal=AbortSignal.timeout(T));const A=(e,o=!0)=>{if(c)u.response=e.cloneNode(!0),v?.("response",e);else{let i=[];const l=(o?e.cloneNode(!0):e).content.childNodes;if(s.nodes){const e=s.parentNode;e||t("parentNode is null");const o=[],n=s.nodes.length;for(let t=0;t<n;t++){const r=s.nodes[t];if(t===n-1)for(let t=0;t<l.length;t++){const n=l[t],s=e.insertBefore(n,r);o.push(s)}e.removeChild(r)}i=o.slice(),s.nodes=o}else{const e=n.parentNode,t=[];for(let o=0;o<l.length;o++){const r=l[o],s=e.insertBefore(r,n);t.push(s)}e.removeChild(n),i=t.slice(),s.nodes=t,s.parentNode=e}a&&(h.response=i,v?.("response",i,h)),v?.("response",r)}};let S=!1,q=!1;const k=e=>{if(p)if(0===e){const e=p.loading;void 0!==e&&A(e)}else if(-1===e){const e=p.error;if(void 0!==e)A(e);else if(s.nodes){const e=s.parentNode;e||t("parentNode is null");const o=s.nodes.length;for(let t=0;t<o;t++){const n=s.nodes[t];t===o-1&&e.insertBefore(s.comment,n),e.removeChild(n)}s.nodes=null,s.parentNode=null}}else{const t=p[`${e}`];if(e>399){const e=p.error;void 0!==t&&(void 0!==e&&(S=!0),A(t))}else void 0!==t&&(q=!0,A(t))}},L=e=>{a?h.status!==e&&(h.status=e,v?.("status",e,h)):u.status!==e&&(u.status=e,v?.("status",e)),k(e)};L(0),fetch(l,$).then((e=>(L(e.status),e.ok||t(`Request error with code ${e.status}`),e.text()))).then((e=>{if(!q){const o=(e=>{"string"!=typeof e&&t("Bad response");const o=d(e),n=o.content,r=n.querySelectorAll("script");for(let e=0;e<r.length;e++){const t=r[e];n.removeChild(t)}return o})(e);if(c)u.response=o,v?.("response",o);else{const e=[],t=o.content.childNodes;if(s)A(o,!1);else{const o=n.parentNode;for(let r=0;r<t.length;r++){const s=t[r],i=o.insertBefore(s,n);a&&e.push(i)}o.removeChild(n),a&&(h.response=e,v?.("response",e,h)),v?.("response",r)}}}})).catch((e=>{throw S||k(-1),e}))},a=e=>{var o;e.get&&(o=e.get,"[object Function]"!==Object.prototype.toString.call(o)&&t("The get property has a function value"))};return{compile:o=>{"string"!=typeof o&&t("template was not found or the type of the passed value is not string"),o||t("template empty");const f=[],u=o.split(i).filter(Boolean);let h,p,g=-1,m="";for(let o=0;o<u.length;o++){const i=u[o],l="}"===i;if("{"===i)g>1&&t("Object nesting error"),-1===g?p={startId:o,endId:NaN}:p&&(m+=i),g++,h=!0;else if(l)if(h&&0===g&&t("There are no query objects between the brackets"),-1===g)t("Template error");else if(-1==--g&&void 0!==h){const i=e=>e=(e=e.trim()).replace(/\r?\n|\r/g,""),l=i(m),d=JSON.parse(l);for(const o in d){const i=d[o];"src"!==o&&o!==n&&"ref"!==o&&o!==r&&o!==s&&"on"!==o&&t(`Property ${o} is not processed`),"on"===o?e(i)||Array.isArray(i)||t(`The value of the property ${o} must be an object or an array`):"string"!=typeof i&&t(`The value of the property ${o} must be a string`)}p.endId=o;const c={...d,...p};f.push(c),h=void 0,p=void 0,m=""}else p&&(m+=i),h=!1;else p&&(m+=i)}0===f.length&&t("Request not found");let y=0;for(let e=0;e<f.length;e++){const t=f[e],o=`\x3c!--hmpl${e}--\x3e`,{startId:n,endId:r}=t,s=r-n;u.splice(n-y,s+1,o),y+=r-n,delete t.startId,delete t.endId}o=u.join("");let v=!1;const N=(e=>{const o=d(e);o.content.children.length>1&&t('Template include only one node with type "Element" or "Comment"');const n=e=>{switch(e.nodeType){case Node.ELEMENT_NODE:if("pre"===e.tagName)return;break;case Node.TEXT_NODE:if(!/\S/.test(e.textContent))return void e.remove()}for(let t=0;t<e.childNodes.length;t++)n(e.childNodes.item(t))};n(o.content.childNodes[0]);let r=o.content.firstElementChild;if(!r){const e=o.content.firstChild,n=8===e?.nodeType;n?(v=n,r=e):t("Element is undefined")}return r})(o);return((o,i,a,f=!1)=>{const u=(o,i)=>{const a=o.src;if(a){const u=(o.method||"GET").toLowerCase();if(!(e=>"get"!==e&&"post"!==e&&"put"!==e&&"delete"!==e&&"patch"!==e)(u)){const n=o.after;n&&f&&t("EventTarget is undefined");const h=o.mode,p=(h||"all").toLowerCase();"one"!==p&&"all"!==p&&t(`${s} has only ONE or ALL values`);const g=o.ref,m="all"===p,y=o.nodeId;let v=o.on;if(v){const o=e=>{const{trigger:o,content:n}=e;o||t("Indicator trigger error"),n||t("Indicator content error"),-1===l.indexOf(o)&&"loading"!==o&&"error"!==o&&t("Indicator trigger error");const r=d(n);return{...e,content:r}};if(e(v)){const e=o(v);v={[`${e.trigger}`]:e.content}}else{const e={},n=[];for(let r=0;r<v.length;r++){const s=o(v[r]),{trigger:i}=s;-1===n.indexOf(i)?n.push(i):t("Indicator trigger must be unique"),e[`${i}`]=s.content}v=e}}const N=(e,o=!1)=>{if(o){if(g){let o;for(let t=0;t<e.length;t++){const n=e[t];if(n.id===g){o=n.options;break}}return o||t("id referenced by request not found"),o}return{}}return g&&t("id referenced by request not found"),e},b=m&&n,w=(e,o,n,r,s,l=!1,d,h=!1,p)=>{const g=r.currentId;if(f)e||(e=i);else if(!e)if(p)e=p.el;else{let o;const{els:n}=r;for(let e=0;e<n.length;e++){const t=n[e];if(t.id===y){p=t,o=t.el;break}}o||t("Element error"),e=o}let m;f||(b||v)&&(p||t("Element error"),m=p.objNode,m||(m={id:g,nodes:null,parentNode:null,comment:e},p.objNode=m,r.dataObjects.push(m),r.currentId++));const w=N(o,l);c(e,s,m,u,a,f,h,w,n,d,v)};let T=w;if(n){const e=(e,o,n,r,s,i,l,d,c,a,f)=>{const u=c.querySelectorAll(n);0===u.length&&t("Selectors nodes not found");const h=m?()=>{w(e,r,s,i,c,l,a,d,f)}:()=>{w(e,r,s,i,c,l,a,d,f);for(let e=0;e<u.length;e++)u[e].removeEventListener(o,h)};for(let e=0;e<u.length;e++)u[e].addEventListener(o,h)};if(n.indexOf(":")>0){const t=n.split(":"),o=t[0],r=t.slice(1).join(":");T=(t,n,s,i,l,d=!1,c,a=!1,f)=>{e(t,o,r,n,s,i,d,a,l,c,f)}}else t(`${r} attribute doesn't work without EventTargets`)}else h&&t(`${s} attribute doesn't work without ${r}`);return T}t(`${n} has only GET, POST, PUT, PATCH or DELETE values`)}else t('The "source" attribute are not found or empty')};let h;if(f)a[0].el=o,h=u(a[0]);else{let e=-2;const n=o=>{if(e++,8==o.nodeType){let n=o.nodeValue;if(n&&n.startsWith("hmpl")){n=n.slice(4);const r=Number(n),s=a[r];(Number.isNaN(r)||void 0===s)&&t("Request index error"),s.el=o,s.nodeId=e}}if(o.hasChildNodes()){const e=o.childNodes;for(let t=0;t<e.length;t++)n(e[t])}};n(o);const r=[];for(let e=0;e<a.length;e++){const t=a[e];r.push(u(t,o))}if(a.length>1)h=(e,o,n,s,i,l=!1)=>{e||(e=i);const d=[],c=s.els;for(let i=0;i<c.length;i++){const a=c[i],f=a.el;null===f.parentNode&&t('"parentNode" is null');const u={response:void 0,status:0};(0,r[i])(f,o,n,s,e,l,u,!0,a),d.push(u)}n.requests=d};else{const e=a[0];null===e.el.parentNode&&t('"parentNode" is null'),h=u(e,o)}}return i(h)})(N,(o=>(n={})=>{const r=N.cloneNode(!0),s={response:v?void 0:r};v&&(s.status=0);const i={dataObjects:[],els:[],currentId:0};if(!v){let e=-2;const t=o=>{if(e++,8==o.nodeType){const t=o.nodeValue;if(t&&t.startsWith("hmpl")){const t={el:o,id:e};i.els.push(t)}}if(o.hasChildNodes()){const e=o.childNodes;for(let o=0;o<e.length;o++)t(e[o])}};t(r)}return e(n)?(a(n),o(void 0,n,s,i,r)):Array.isArray(n)&&((o=>{const n=[];for(let r=0;r<o.length;r++){const s=o[r];e(s)||t('options is of type "object"'),a(s);const{id:i}=s;"string"!=typeof s.id&&t('id is of type "string"'),n.indexOf(i)>-1?t(`id with value "${i}" already exists`):n.push(i)}})(n),o(void 0,n,s,i,r,!0)),s}),f,v)},stringify:e=>JSON.stringify(e)}}()}));