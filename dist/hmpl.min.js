!function(e,t){"object"==typeof module&&module.exports?module.exports=t():"function"==typeof define&&define.amd?define([],t):e.hmpl=e.hmpl||t()}("undefined"!=typeof self?self:this,(function(){return function(){"use strict";const e=e=>"object"==typeof e&&!Array.isArray(e)&&null!==e,t=e=>{throw new Error(e)},o=e=>{console.warn(e)},n="method",r="initId",s="after",i="mode",l="indicators",d=/([{}])/,c=[100,101,102,103,300,301,302,303,304,305,306,307,308,400,401,402,403,404,405,406,407,408,409,410,411,412,413,414,415,416,417,418,421,422,423,424,425,426,428,429,431,451,500,501,502,503,504,505,506,507,508,510,511],a=e=>(new DOMParser).parseFromString(`<template>${e}</template>`,"text/html").childNodes[0].childNodes[0].firstChild,f=(n,r,s,i,l,d,c,f={},p,u,h)=>{const{mode:g,cache:m,redirect:v,get:y,referrerPolicy:N,signal:b,credentials:w,timeout:T,referrer:E,headers:I,body:j,window:C,integrity:O}=f,$={method:i.toUpperCase()};void 0!==w&&($.credentials=w),void 0!==j&&($.body=j),void 0!==g&&($.mode=g),void 0!==m&&($.cache=m),void 0!==v&&($.redirect=v),void 0!==N&&($.referrerPolicy=N),void 0!==O&&($.integrity=O),void 0!==E&&($.referrer=E);const x=void 0!==b;if(x&&($.signal=b),void 0!==C&&($.window=C),void 0!==f.keepalive&&o("keepalive property is not yet supported"),I)if(e(I)){const e=new Headers;for(const o in I){const[n,r]=o;if("string"==typeof r)try{e.set(n,r)}catch(e){throw e}else t("Header has no string value")}$.headers=e}else t('The "header" property does not have a value object');T&&(x?o("The signal property overwrote the AbortSignal from timeout"):$.signal=AbortSignal.timeout(T));const A=(e,o=!0)=>{if(d)p.response=e.cloneNode(!0),y?.("response",e);else{let i=[];const l=(o?e.cloneNode(!0):e).content.childNodes;if(s.nodes){const e=s.parentNode;e||t("parentNode is null");const o=[],n=s.nodes.length;for(let t=0;t<n;t++){const r=s.nodes[t];if(t===n-1)for(let t=0;t<l.length;t++){const n=l[t],s=e.insertBefore(n,r);o.push(s)}e.removeChild(r)}i=o.slice(),s.nodes=o}else{const e=n.parentNode,t=[];for(let o=0;o<l.length;o++){const r=l[o],s=e.insertBefore(r,n);t.push(s)}e.removeChild(n),i=t.slice(),s.nodes=t,s.parentNode=e}c&&(u.response=i,y?.("response",i,u)),y?.("response",r)}};let k=!1,S=!1;const q=()=>{if(d)p.response=void 0,y?.("response",void 0);else if(s.nodes){const e=s.parentNode;e||t("parentNode is null");const o=s.nodes.length;for(let t=0;t<o;t++){const n=s.nodes[t];t===o-1&&e.insertBefore(s.comment,n),e.removeChild(n)}s.nodes=null,s.parentNode=null,c&&(u.response=void 0,y?.("response",void 0,u)),y?.("response",r)}},L=e=>{c?u.status!==e&&(u.status=e,y?.("status",e,u)):p.status!==e&&(p.status=e,y?.("status",e)),(e=>{if(h)if("pending"===e){const e=h.pending;void 0!==e&&A(e)}else if("rejected"===e){const e=h.rejected;if(void 0!==e)A(e);else{const e=h.error;void 0!==e?A(e):q()}}else{const t=h[`${e}`];if(e>399)if(k=!0,void 0!==t)A(t);else{const e=h.error;void 0!==e?A(e):q()}else(e<199||e>299)&&(S=!0,void 0!==t?A(t):q())}})(e)};L("pending"),fetch(l,$).then((e=>(L(e.status),e.ok||t(`Request error with code ${e.status}`),e.text()))).then((e=>{if(!S){const o=(e=>{"string"!=typeof e&&t("Bad response");const o=a(e),n=o.content,r=n.querySelectorAll("script");for(let e=0;e<r.length;e++){const t=r[e];n.removeChild(t)}return o})(e);if(d)p.response=o,y?.("response",o);else{const e=[],t=o.content.childNodes;if(s)A(o,!1);else{const o=n.parentNode;for(let r=0;r<t.length;r++){const s=t[r],i=o.insertBefore(s,n);c&&e.push(i)}o.removeChild(n),c&&(u.response=e,y?.("response",e,u)),y?.("response",r)}}}})).catch((e=>{throw k||L("rejected"),e}))},p=e=>{var o;e.get&&(o=e.get,"[object Function]"!==Object.prototype.toString.call(o)&&t("The get property has a function value"))};return{compile:o=>{"string"!=typeof o&&t("template was not found or the type of the passed value is not string"),o||t("template empty");const u=[],h=o.split(d).filter(Boolean);let g,m,v=-1,y="";for(let e=0;e<h.length;e++){const o=h[e],d="}"===o;if("{"===o)v>1&&t("Object nesting error"),-1===v?m={startId:e,endId:NaN}:m&&(y+=o),v++,g=!0;else if(d)if(g&&0===v&&t("There are no query objects between the brackets"),-1===v)t("Template error");else if(-1==--v&&void 0!==g){const o=e=>e=(e=e.trim()).replace(/\r?\n|\r/g,""),d=o(y),c=JSON.parse(d);for(const e in c){const o=c[e];switch("src"!==e&&e!==n&&e!==r&&e!==s&&e!==i&&e!==l&&t(`Property ${e} is not processed`),e){case l:Array.isArray(o)||t(`The value of the property ${e} must be an array`);break;case r:"string"!=typeof o&&"number"!=typeof o&&t(`The value of the property ${e} must be a string`);break;default:"string"!=typeof o&&t(`The value of the property ${e} must be a string`)}}m.endId=e;const a={...c,...m};u.push(a),g=void 0,m=void 0,y=""}else m&&(y+=o),g=!1;else m&&(y+=o)}0===u.length&&t("Request not found");let N=0;for(let e=0;e<u.length;e++){const t=u[e],o=`\x3c!--hmpl${e}--\x3e`,{startId:n,endId:r}=t,s=r-n;h.splice(n-N,s+1,o),N+=r-n,delete t.startId,delete t.endId}o=h.join("");let b=!1;const w=(e=>{const o=a(e);o.content.children.length>1&&t('Template include only one node with type "Element" or "Comment"');const n=e=>{switch(e.nodeType){case Node.ELEMENT_NODE:if("pre"===e.tagName)return;break;case Node.TEXT_NODE:if(!/\S/.test(e.textContent))return void e.remove()}for(let t=0;t<e.childNodes.length;t++)n(e.childNodes.item(t))};n(o.content.childNodes[0]);let r=o.content.firstElementChild;if(!r){const e=o.content.firstChild,n=8===e?.nodeType;n?(b=n,r=e):t("Element is undefined")}return r})(o);return((e,o,r,l=!1)=>{const d=(e,o)=>{const r=e.src;if(r){const d=(e.method||"GET").toLowerCase();if(!(e=>"get"!==e&&"post"!==e&&"put"!==e&&"delete"!==e&&"patch"!==e)(d)){const n=e.after;n&&l&&t("EventTarget is undefined");const p=e.mode,u=(p||"all").toLowerCase();"one"!==u&&"all"!==u&&t(`${i} has only ONE or ALL values`);const h=e.initId,g="all"===u,m=e.nodeId;let v=e.indicators;if(v){const e=e=>{const{trigger:o,content:n}=e;o||t("Indicator trigger error"),n||t("Indicator content error"),-1===c.indexOf(o)&&"pending"!==o&&"rejected"!==o&&"error"!==o&&t("Indicator trigger error");const r=a(n);return{...e,content:r}},o={},n=[];for(let r=0;r<v.length;r++){const s=e(v[r]),{trigger:i}=s;-1===n.indexOf(i)?n.push(i):t("Indicator trigger must be unique"),o[`${i}`]=s.content}v=o}const y=(e,o=!1)=>{if(o){if(h){let o;for(let t=0;t<e.length;t++){const n=e[t];if(n.id===h){o=n.value;break}}return o||t("id referenced by request not found"),o}return{}}return h&&t("id referenced by request not found"),e},N=g&&n,b=(e,n,s,i,c,a=!1,p,u=!1,h)=>{const g=i.currentId;if(l)e||(e=o);else if(!e)if(h)e=h.el;else{let o;const{els:n}=i;for(let e=0;e<n.length;e++){const t=n[e];if(t.id===m){h=t,o=t.el;break}}o||t("Element error"),e=o}let b;l||(N||v)&&(h||t("Element error"),b=h.objNode,b||(b={id:g,nodes:null,parentNode:null,comment:e},h.objNode=b,i.dataObjects.push(b),i.currentId++));const w=y(n,a);f(e,c,b,d,r,l,u,w,s,p,v)};let w=b;if(n){const e=(e,o,n,r,s,i,l,d,c,a,f)=>{const p=c.querySelectorAll(n);0===p.length&&t("Selectors nodes not found");const u=g?()=>{b(e,r,s,i,c,l,a,d,f)}:()=>{b(e,r,s,i,c,l,a,d,f);for(let e=0;e<p.length;e++)p[e].removeEventListener(o,u)};for(let e=0;e<p.length;e++)p[e].addEventListener(o,u)};if(n.indexOf(":")>0){const t=n.split(":"),o=t[0],r=t.slice(1).join(":");w=(t,n,s,i,l,d=!1,c,a=!1,f)=>{e(t,o,r,n,s,i,d,a,l,c,f)}}else t(`${s} attribute doesn't work without EventTargets`)}else p&&t(`${i} attribute doesn't work without ${s}`);return w}t(`${n} has only GET, POST, PUT, PATCH or DELETE values`)}else t('The "source" attribute are not found or empty')};let p;if(l)r[0].el=e,p=d(r[0]);else{let o=-2;const n=e=>{if(o++,8==e.nodeType){let n=e.nodeValue;if(n&&n.startsWith("hmpl")){n=n.slice(4);const s=Number(n),i=r[s];(Number.isNaN(s)||void 0===i)&&t("Request index error"),i.el=e,i.nodeId=o}}if(e.hasChildNodes()){const t=e.childNodes;for(let e=0;e<t.length;e++)n(t[e])}};n(e);const s=[];for(let t=0;t<r.length;t++){const o=r[t];s.push(d(o,e))}if(r.length>1)p=(e,o,n,r,i,l=!1)=>{e||(e=i);const d=[],c=r.els;for(let i=0;i<c.length;i++){const a=c[i],f=a.el;null===f.parentNode&&t('"parentNode" is null');const p={response:void 0};(0,s[i])(f,o,n,r,e,l,p,!0,a),d.push(p)}n.requests=d};else{const o=r[0];null===o.el.parentNode&&t('"parentNode" is null'),p=d(o,e)}}return o(p)})(w,(o=>(n={})=>{const r=w.cloneNode(!0),s={response:b?void 0:r},i={dataObjects:[],els:[],currentId:0};if(!b){let e=-2;const t=o=>{if(e++,8==o.nodeType){const t=o.nodeValue;if(t&&t.startsWith("hmpl")){const t={el:o,id:e};i.els.push(t)}}if(o.hasChildNodes()){const e=o.childNodes;for(let o=0;o<e.length;o++)t(e[o])}};t(r)}return e(n)?(p(n),o(void 0,n,s,i,r)):Array.isArray(n)&&((o=>{const n=[];for(let r=0;r<o.length;r++){const s=o[r];e(s)||t('options is of type "object"'),p(s);const{id:i}=s;"string"!=typeof s.id&&"number"!=typeof s.id&&t('Id must be a "string" or a "number".'),n.indexOf(i)>-1?t(`id with value "${i}" already exists`):n.push(i)}})(n),o(void 0,n,s,i,r,!0)),s}),u,b)},stringify:e=>JSON.stringify(e)}}()}));